
> [!NOTE] Stuxnet, FinFisher, et al.

DLL Search Order (Desktop Apps)

```c
DLL already in memory

HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs

App's directory

C:\Windows\System32\ | SysWoW64

C:\Windows\System

C:\Windows\

Current directory

%PATH%
```

Nous devons avoir 02 choses:

- Quelque qui s'executer automatiquement

```c
reg query HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
```

Pour verifier si une application est vulnerable au DLL Hijancking on utiliser l'outil `procmon` de la suite sysinternal et chercher les `NOT FOUND`

---

Setup:

Voir tout les DLL utiliser par une application

```c
dumpbin /imports c:\BGinfo\BGINFO.EXE
```

```c
compile.bat
copy c:\RTO\PERS\01.USER\DLL-hijack\winspool.drv c:\BGinfo
```

```c
copy c:\Windows\SysWOW64\winspool.drv c:\BGinfo\winsplhlp.dll
```

Supprimer:

```http
del c:\BGinfo\winspool.drv c:\BGinfo\winsplhlp.dll
```

